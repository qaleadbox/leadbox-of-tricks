<!DOCTYPE html>
<html>

<head>
  <title>LeadBox of Tricks</title>
  <link rel="stylesheet" href="popup.css">
</head>

<body>
  <div class="header-container">
    <div class="header">
      <h1>LeadBox of Tricks <span id="version"></span></h1>
    </div>
  </div>

  <button class="features-button" id="featuresButton">+</button>
  <div class="features-list" id="featuresList">
    <h2>All Features</h2>
    
    <div class="feature-section">
      <h3>Click to Use Features</h3>
      <ul>
        <li>
          <div class="feature-title">HREF Extraction</div>
          <div class="feature-description">Extract links from sitemap HTML structure and export to spreadsheet format.</div>
          <ul>
            <li>Paste sitemap HTML structure</li>
            <li>Automatically extracts all links</li>
            <li>Exports to spreadsheet format</li>
          </ul>
        </li>
        <li>
          <div class="feature-title">Missing Images Checker</div>
          <div class="feature-description">Scan and identify coming soon images in the current page.</div>
        </li>
        <li>
          <div class="feature-title">Small Images Checker</div>
          <div class="feature-description">Scan and identify images that are too small (below minimum dimensions or file size).</div>
        </li>
        <li>
          <div class="feature-title">CSV Data Matcher</div>
          <div class="feature-description">Match CSV data with SRP cards information.</div>
        </li>
        <li>
          <div class="feature-title">Vehicle Data Exporter</div>
          <div class="feature-description">Export all vehicle data from the current page to CSV format.</div>
          <ul>
            <li>Reverse feature of CSV Data Matcher</li>
            <li>Scrolls through page to load all vehicles</li>
            <li>Extracts all configured fields</li>
            <li>Exports to CSV file for comparison with other sites</li>
          </ul>
        </li>
      </ul>
    </div>

    <div class="feature-section">
      <h3>Automatic Observer Features</h3>
      <ul>
        <li>
          <div class="feature-title">LeadBox Admin Printer Icon</div>
          <div class="feature-description">Automatically adds a printer icon next to each magnifying glass in the leads list.</div>
          <ul>
            <li>Uses native LeadBox printer icon for consistency</li>
            <li>Opens in same popup style as magnifying glass</li>
            <li>Works with dynamically loaded content</li>
            <li>Maintains same styling and behavior</li>
          </ul>
        </li>
      </ul>
    </div>
  </div>

  <button id="check missing images">Scan for Coming Soon Images <span class="availability-text">(AVAILABLE ON SRPs)</span></button>
  
  <div id="methodSelectionDiv" style="display: none; margin-bottom: 10px; padding: 10px; background: rgba(255, 255, 255, 0.1); border-radius: 4px;">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
      <label style="font-weight: bold; color: white;">Image Check Method:</label>
      <div style="display: flex; align-items: center; gap: 10px;">
        <label style="display: flex; align-items: center; gap: 5px; cursor: pointer;">
          <input type="radio" name="imageCheckMethod" value="ocr" id="ocrMethod" style="margin: 0;">
          <span>OCR</span>
        </label>
        <label style="display: flex; align-items: center; gap: 5px; cursor: pointer;">
          <input type="radio" name="imageCheckMethod" value="openai" id="openaiMethod" style="margin: 0;" disabled>
          <span>OpenAI</span>
        </label>
      </div>
    </div>
    <div style="font-size: 12px; color: #ccc; line-height: 1.4;">
      <strong>OCR:</strong> Free, text-based detection<br>
      <strong>OpenAI:</strong> Paid, AI-powered, more accurate, but with costs (becareful since VDPs has many images)
    </div>
    <div style="margin-top: 10px; padding: 8px; background: rgba(0, 0, 0, 0.2); border-radius: 4px;">
      <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; color: white;">
        <input type="checkbox" id="enableComingSoonCache" style="margin: 0;">
        <span style="font-size: 13px;">
          <strong>Enable File Size Caching</strong>
          <div style="font-size: 11px; color: #aaa; margin-top: 2px;">
            Speeds up detection by caching results based on image file size.
            Disable if regular vehicle photos have the same size as placeholder images.
          </div>
        </span>
      </label>
    </div>
    <button id="startScanning" style="margin-top: 10px;">Start Scanning</button>
  </div>
  
  <div id="ocrInput" style="display: none; background: white; padding: 10px; border-radius: 4px; position: relative; z-index: 1001; color: black;">
    <div style="background-color: #ff4444; color: white; padding: 10px; border-radius: 4px; margin-bottom: 10px; font-weight: bold; text-align: center; font-size: 16px; text-transform: uppercase;">
      Image checks for this site are only possible through the API
    </div>
    <div class="steps-label">
Steps:
1. Get your OCR API key:
   - Contact the extension developers, or
   - Get a free key at <a href="https://ocr.space/ocrapi/freekey" target="_blank">https://ocr.space/ocrapi/freekey</a>
<span class="bold">2. Enter your OCR key here:</span>
    </div>
    <textarea id="ocrKey" placeholder="Enter your OCR API key here..." style="height: 30px; min-height: 30px; max-height: 30px; resize: none;"></textarea>
    <button id="saveOcrKey">Save OCR Key</button>
  </div>

  <div id="openaiInput" style="display: none; background: white; padding: 10px; border-radius: 4px; position: relative; z-index: 1001; color: black;">
    <div style="background-color: #ff4444; color: white; padding: 10px; border-radius: 4px; margin-bottom: 10px; font-weight: bold; text-align: center; font-size: 16px; text-transform: uppercase;">
      Image checks for this site are only possible through the API
    </div>
    <div class="steps-label">
Steps:
1. Get your OpenAI API key:
   - Sign up at <a href="https://platform.openai.com/api-keys" target="_blank">https://platform.openai.com/api-keys</a>
   - Create a new API key
<span class="bold">2. Enter your OpenAI key here:</span>
    </div>
    <textarea id="openaiKey" placeholder="Enter your OpenAI API key here..." style="height: 30px; min-height: 30px; max-height: 30px; resize: none;"></textarea>
    <button id="saveOpenAIKey">Save OpenAI Key</button>
  </div>
  <script type="module" src="../coming-soon/coming-soon-checker.js"></script>

  <button id="check small images">Scan for Small Images <span class="availability-text">(AVAILABLE ON SRPs)</span></button>
  <div id="smallImageSettingsDiv" style="display: none; margin-bottom: 10px; padding: 10px; background: rgba(255, 255, 255, 0.1); border-radius: 4px;">
    <div style="background-color: #ff6b35; color: white; padding: 10px; border-radius: 4px; margin-bottom: 12px; border-left: 4px solid #ff4444;">
      <div style="display: flex; align-items: flex-start; gap: 8px;">
        <div style="flex: 1;">
          <div style="font-weight: bold; margin-bottom: 4px; font-size: 13px;">CORS PERMISSION REQUIRED</div>
          <div style="font-size: 11px; line-height: 1.4;">
            This feature may be blocked by CORS policy. If you see console errors or the scan doesn't work, the website is blocking cross-origin requests to check image file sizes.
          </div>
        </div>
      </div>
    </div>
    <div style="margin-bottom: 10px;">
      <label id="siteLabel" style="font-weight: bold; color: white;">Image Size Threshold:</label>
      <div style="display: flex; align-items: center; gap: 10px; margin-top: 5px;">
        <input type="number" id="imageSizeThreshold" min="1" max="1000" value="10" style="width: 80px; padding: 4px; border-radius: 4px; border: 1px solid #7f9db9;">
        <span style="color: white;">KB</span>
      </div>
    </div>
    <div style="font-size: 12px; color: #ccc; line-height: 1.4; margin-bottom: 10px;">
      Images smaller than this size will be flagged as "small images"<br>
      <strong>Note:</strong> This setting is saved per website
    </div>
    <button id="startSmallImageScanning" style="margin-top: 10px;">Start Scanning</button>
  </div>
  <script type="module" src="../srp-csv/small-images-checker.js"></script>

  <button id="match csv data with SRP cards information">Validate SRP Cards with CSV Data <span class="availability-text">(AVAILABLE ON SRPs)</span></button>
  <div id="csvInput" style="display: none;">
    <div class="field-mappings" style="display: none;">
      <h3>Vehicle Card Class Names</h3>
      <!-- Field mappings will be dynamically added here -->
    </div>

    <h3>CSV Data <span class="required-asterisk">*</span></h3>
    <textarea id="csvData" placeholder="Paste CSV data here..."></textarea>
    <div style="display: flex; justify-content: space-between; margin-top: 10px;">
      <button id="revealHeader" class="action-button">Review Header</button>
      <button id="processCSV" class="action-button">Process CSV</button>
    </div>
  </div>
  <script type="module" src="../srp-csv/csv-srp-data-matcher.js"></script>

  <button id="export vehicle data to csv">Export Vehicle Data to CSV <span class="availability-text">(AVAILABLE ON SRPs)</span></button>
  <div id="exportVehicleDataSection" style="display: none;">
    <div style="background-color: #4CAF50; color: white; padding: 10px; border-radius: 4px; margin-bottom: 12px; border-left: 4px solid #45a049;">
      <div style="display: flex; align-items: flex-start; gap: 8px;">
        <div style="flex: 1;">
          <div style="font-weight: bold; margin-bottom: 4px; font-size: 13px;">REVERSE FEATURE</div>
          <div style="font-size: 11px; line-height: 1.4;">
            This is the reverse of the CSV validation feature. Instead of importing CSV and validating against the website, this exports website data to CSV.
          </div>
        </div>
      </div>
    </div>
    <div style="font-size: 12px; color: #ccc; line-height: 1.4; margin-bottom: 12px;">
      <strong>Export vehicle data from this page to CSV.</strong><br>
      Select which fields you want to export. Stock Number is mandatory and always included.<br>
      <br>
      <strong>Use Case:</strong> Export data from Site A, then use the CSV to compare with Site B using the validation feature above.
    </div>

    <div class="export-field-mappings">
      <h3>Fields to Export</h3>
      <div id="exportFieldsContainer"></div>
    </div>

    <div style="display: flex; justify-content: flex-end; margin-top: 10px;">
      <button id="startVehicleDataExport" class="action-button">Start Export</button>
    </div>
  </div>
  <script type="module" src="../export-vehicle-data/vehicle-data-exporter.js"></script>

  <button id="Copy Unordered List Links">Copy Unordered List Links <span class="availability-text">(AVAILABLE ON SITEMAPs)</span></button>
  <div class="modal-overlay" id="modalOverlay"></div>
  <div id="hrefInput">
    <div class="steps-label">
Steps:
1. Access the SiteMap
2. Inspect the elements list
3. Copy the ul element with li inside
<span class="bold">4. Paste here (should follow this structure):</span>
    </div>
    <textarea id="liElements" placeholder="&lt;ul&gt;
  &lt;li&gt;
    &lt;a href=&quot;https://example.com/page&quot;&gt;Page Title&lt;/a&gt;
  &lt;/li&gt;
&lt;/ul&gt;"></textarea>
    <button id="processHrefs">Extract the links</button>
  </div>

  <script type="module" src="../sitemap-tools/ul-link-extractor.js"></script>
  <script type="module" src="../version.js"></script>
  <script type="module" src="../intellisense/intellisense-system.js"></script>
  <script type="module" src="../popup/popup.js"></script>

  <button class="docs-button" title="View Documentation">i</button>
  <div class="docs-popup">
    <h2>Documentation</h2>
    
    <a href="https://github.com/qaleadbox/leadbox-of-tricks?tab=readme-ov-file#how-to-install" target="_blank" class="topic">
      <div class="topic-title">How to install</div>
      <div class="topic-description">Installation guide for Google Chrome</div>
    </a>

    <a href="https://github.com/qaleadbox/leadbox-of-tricks?tab=readme-ov-file#how-to-use" target="_blank" class="topic">
      <div class="topic-title">How to use</div>
      <div class="topic-description">Feature guides and usage instructions</div>
    </a>

    <a href="https://github.com/qaleadbox/leadbox-of-tricks?tab=readme-ov-file#structure" target="_blank" class="topic">
      <div class="topic-title">Structure</div>
      <div class="topic-description">Project folder structure and file descriptions</div>
    </a>

    <a href="https://github.com/qaleadbox/leadbox-of-tricks?tab=readme-ov-file#development-status" target="_blank" class="topic">
      <div class="topic-title">Development Status</div>
      <div class="topic-description">Current progress and pending items</div>
    </a>

    <a href="https://github.com/qaleadbox/leadbox-of-tricks?tab=readme-ov-file#known-issues" target="_blank" class="topic">
      <div class="topic-title">Known Issues</div>
      <div class="topic-description">Current limitations and bugs</div>
    </a>

    <a href="https://github.com/qaleadbox/leadbox-of-tricks?tab=readme-ov-file#goal" target="_blank" class="topic">
      <div class="topic-title">Goal</div>
      <div class="topic-description">Project objectives and future plans</div>
    </a>
  </div>
  
  <div class="import-export-section">
    <div id="manualSelectorsContainer">
      <h3>Mandatory Vehicle Selectors</h3>
      <div id="fieldsContainer"></div>
      <button id="addFieldBtn">+ Add Field</button>
      <button id="saveManualSelectors">Save Selectors</button>
    </div>
  
    <button id="saveSelectors">Save Mapping</button>
    <button id="exportSelectors">Export Vehicle Selectors</button>
    <label for="importSelectors">Import Vehicle Selectors:</label>
    <input type="file" id="importSelectors" accept=".json">
  </div>
  
  <div class="import-export-section">
    <h2>Import/Export Field Maps</h2>
    <div class="import-export-buttons">
      <button id="exportButton">Export Field Maps</button>
      <label for="importFile" class="file-input-label">Import Field Maps</label>
      <input type="file" id="importFile" accept=".json">
    </div>
  </div>

  <div class="import-export-section">
    <h2>Intellisense System</h2>
    <div style="font-size: 12px; color: #ccc; margin-bottom: 10px;">
      Works on all websites. Learns from everything you type. Green flash indicates saved terms. Press Tab to accept suggestions.
    </div>
    <div class="import-export-buttons">
      <button id="exportIntellisenseProfile">Export Profile</button>
      <label for="importIntellisenseFile" class="file-input-label">Import Profile</label>
      <input type="file" id="importIntellisenseFile" accept=".json">
      <button id="showIntellisenseStats">View Stats</button>
    </div>
  </div>

  <div class="import-export-section">
    <h2>Settings</h2>
    <div style="display:flex; flex-direction:column; gap:8px; color:white;">
      <label style="display:flex; align-items:center; gap:8px;">
        <input type="checkbox" id="toggleEditIcon" />
        <span>LeadBox Admin Internal Leads Edit Icon</span>
      </label>
      <label style="display:flex; align-items:center; gap:8px;">
        <input type="checkbox" id="togglePrinterIcon" />
        <span>LeadBox Admin Internal Leads Printer Icon</span>
      </label>
      <label style="display:flex; align-items:center; gap:8px;">
        <input type="checkbox" id="toggleAutofill" />
        <span>Text Autofilling</span>
      </label>
      <div style="font-size:12px; color:#ccc;">Changes apply immediately on new pages; reload pages for full effect.</div>
    </div>
  </div>

  <div class="loading-overlay" id="loadingOverlay">
    <div class="loading-spinner"></div>
  </div>

</body>

</html>